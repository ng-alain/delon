import{a as x}from"./chunk-ELXT6WKP.js";import{E as g,F as p,Hc as f,Ic as P,Ld as V,Nb as N,O as v,P as y,Qa as h,Ua as w,Za as O,a as c,ca as _,ec as T,fa as M,ha as a,ia as E,qa as D,ra as b,sc as F,uc as u,xc as I,ya as C,yc as d}from"./chunk-ALCLPDZJ.js";var k=new M("NU_MONACO_EDITOR_CONFIG");function te(o){return E([{provide:k,useValue:o}])}var A=!1,R,$=(()=>{class o{el=a(C);config=a(k,{optional:!0});doc=a(D);ngZone=a(O);destroy$=a(b);_editor;_resize$=null;_config;_disabled;height=d("200px");delay=d(0,{transform:P});disabled=d(!1,{transform:f});options=d();event=I();constructor(){this._config=c({baseUrl:"https://cdn.jsdelivr.net/npm/monaco-editor/min",autoFormatTime:100},this.config),u(()=>{this.setDisabled(this.disabled())}),u(()=>{let e=this.options();this.updateOptions(e)})}notifyEvent(e,t){this.ngZone.run(()=>this.event.emit(c({type:e,editor:this._editor},t)))}setDisabled(e){return this._editor?.updateOptions({readOnly:e}),this}init(){if(A){R.then(()=>this.initMonaco(this.options(),!0));return}A=!0,R=new Promise((e,t)=>{let i=window;if(i==null){e();return}if(i.monaco){e();return}let n=`${this._config.baseUrl}/vs`;/^https?:\/\//g.test(n)||(n=`${window.location.origin}/${n.startsWith("/")?n.substring(1):n}`);let l=()=>{i.require.config({paths:{vs:n}}),typeof this._config.monacoPreLoad=="function"&&this._config.monacoPreLoad(),i.require(["vs/editor/editor.main"],()=>{typeof this._config.monacoLoad=="function"&&this._config.monacoLoad(i.monaco),this.initMonaco(this.options(),!0),e()},()=>{t("Unable to load editor/editor.main module, please check your network environment.")})};if(i.require)l();else{let r=this.doc.createElement("script");r.type="text/javascript",r.src=`${n}/loader.js`,r.onload=l,r.onerror=()=>t(`Unable to load ${r.src}, please check your network environment.`),this.doc.getElementsByTagName("head")[0].appendChild(r)}}).catch(e=>this.notifyEvent("load-error",{error:e}))}cleanResize(){return this._resize$?.unsubscribe(),this}registerResize(){return this.cleanResize(),this._resize$=g(window,"resize").pipe(v(100)).subscribe(()=>{this._editor.layout(),this.notifyEvent("resize")}),this}updateOptions(e){this._editor&&this.ngZone.runOutsideAngular(()=>{this._editor.dispose(),this.initMonaco(e,!1)})}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>setTimeout(()=>this.init(),+this.delay()))}ngOnDestroy(){this.cleanResize(),this._editor?.dispose()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["nu-monaco-base"]],inputs:{height:[1,"height"],delay:[1,"delay"],disabled:[1,"disabled"],options:[1,"options"]},outputs:{event:"event"},decls:0,vars:0,template:function(t,i){},encapsulation:2})}return o})(),m=class{ID="editor.widget.placeholderHint";placeholder;editor;node;constructor(s,e){this.placeholder=e,this.editor=s}update(s){this.node!=null&&(this.node.innerHTML=s??this.placeholder??"")}getId(){return this.ID}getDomNode(){if(this.node==null){let s=this.node=document.createElement("div");s.classList.add("monaco-editor-placeholder"),s.style.width="max-content",s.style.color="gray",s.innerHTML=this.placeholder,s.style.fontStyle="italic",this.editor.applyFontInfo(s)}return this.node}getPosition(){return{position:{lineNumber:1,column:1},preference:[monaco.editor.ContentWidgetPositionPreference.EXACT]}}dispose(){this.editor.removeContentWidget(this)}},oe=(()=>{class o extends ${_value="";_placeholderWidget;placeholder=d();model=d();autoFormat=d(!0,{transform:f});get editor(){return this._editor}constructor(){super(),u(()=>{let e=this.placeholder();this._placeholderWidget?.update(e)}),u(()=>{this.model()!=null&&this.updateOptions(F(()=>this.options()))})}togglePlaceholder(){let e=this.placeholder();e==null||e.length<=0||this.editor==null||(this._placeholderWidget==null&&(this._placeholderWidget=new m(this.editor,e)),this._value.length>0?this.editor.removeContentWidget(this._placeholderWidget):this.editor.addContentWidget(this._placeholderWidget))}onChange=e=>{};onTouched=()=>{};initMonaco(e,t){let i=!!this.model();if(e=c(c({},this.config?.defaultOptions),e),i){let r=monaco.editor.getModel(this.model().uri||"");if(r)e.model=r,e.model.setValue(this._value);else{let{value:z,language:U,uri:W}=this.model();e.model=monaco.editor.createModel(z||this._value,U,W)}this._value=e.model.getValue()}this._disabled!=null&&(e.readOnly=this._disabled);let n=this._editor=monaco.editor.create(this.el.nativeElement,e);i||n.setValue(this._value),n.onDidChangeModelContent(()=>{let r=n.getValue();this._value=r,this.ngZone.run(()=>{this.onChange(r)}),this.togglePlaceholder()}),n.onDidBlurEditorWidget(()=>this.onTouched()),this.togglePlaceholder(),this.registerResize();let l=t?"init":"re-init";if(this.autoFormat()){p(this._config.autoFormatTime).pipe(V(this.destroy$),y(1)).subscribe(()=>{this.format()?.then(()=>this.notifyEvent(l))});return}this.notifyEvent(l)}format(){let e=this.editor?.getAction("editor.action.formatDocument");if(e!=null)return e.run()}writeValue(e){this._value=e||"",this._editor?.setValue(this._value),this.autoFormat()&&this.format()}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.setDisabled(e)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["nu-monaco-editor"]],hostVars:4,hostBindings:function(t,i){t&2&&N("display","block")("height",i.height())},inputs:{placeholder:[1,"placeholder"],model:[1,"model"],autoFormat:[1,"autoFormat"]},exportAs:["nuMonacoEditor"],features:[T([{provide:x,useExisting:_(()=>o),multi:!0}]),w],decls:0,vars:0,template:function(t,i){},encapsulation:2,changeDetection:0})}return o})();export{te as a,oe as b};
