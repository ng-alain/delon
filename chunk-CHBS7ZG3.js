import{a as I}from"./chunk-7OOQUBON.js";import{Ac as R,Bc as d,Ca as x,D as y,E as f,Jc as g,Kc as p,M as _,N as M,Nd as v,Pa as F,Sb as A,Xa as m,a as h,ab as T,ba as D,ea as E,ga as c,ha as C,jc as H,qa as N,ra as w,xa as u,ya as O}from"./chunk-P5SMEL6S.js";var z=new E("NU_MONACO_EDITOR_CONFIG");function Y(i){return C([{provide:z,useValue:i}])}var L=!1,P,W=(()=>{class i{el=c(x);config=c(z,{optional:!0});doc=c(N);destroy$=c(w);_editor;_resize$=null;_config;_disabled;height=d("200px");delay=d(0,{transform:p});disabled=d(!1,{transform:g});options=d();event=R();constructor(){this._config=h({baseUrl:"https://cdn.jsdelivr.net/npm/monaco-editor/min",autoFormatTime:100},this.config),u(()=>{this.setDisabled(this.disabled())}),u(()=>{let e=this.options(),t=this.height();this.updateOptions(e)}),F(()=>{f(this.delay()).pipe(v(this.destroy$)).subscribe(()=>this.init())})}notifyEvent(e,t){this.event.emit(h({type:e,editor:this._editor},t))}setDisabled(e){return this._editor?.updateOptions({readOnly:e}),this}init(){if(L){P.then(()=>this.initMonaco(this.options(),!0));return}L=!0,P=new Promise((e,t)=>{let o=window;if(o==null){e();return}if(o.monaco){e();return}let r=`${this._config.baseUrl}/vs`;/^https?:\/\//g.test(r)||(r=`${window.location.origin}/${r.startsWith("/")?r.substring(1):r}`);let a=()=>{o.require.config({paths:{vs:r}}),typeof this._config.monacoPreLoad=="function"&&this._config.monacoPreLoad(),o.require(["vs/editor/editor.main"],()=>{typeof this._config.monacoLoad=="function"&&this._config.monacoLoad(o.monaco),this.initMonaco(this.options(),!0),e()},()=>{t("Unable to load editor/editor.main module, please check your network environment.")})};if(o.require)a();else{let s=this.doc.createElement("script");s.type="text/javascript",s.src=`${r}/loader.js`,s.onload=a,s.onerror=()=>t(`Unable to load ${s.src}, please check your network environment.`),this.doc.getElementsByTagName("head")[0].appendChild(s)}}).catch(e=>this.notifyEvent("load-error",{error:e}))}cleanResize(){return this._resize$?.unsubscribe(),this}registerResize(){return this.cleanResize(),this._resize$=y(window,"resize").pipe(_(100)).subscribe(()=>{this._editor.layout(),this.notifyEvent("resize")}),this}updateOptions(e){this._editor&&(this._editor.dispose(),this.initMonaco(e,!1))}ngOnDestroy(){this.cleanResize(),this._editor?.dispose()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=m({type:i,selectors:[["nu-monaco-base"]],inputs:{height:[1,"height"],delay:[1,"delay"],disabled:[1,"disabled"],options:[1,"options"]},outputs:{event:"event"},decls:0,vars:0,template:function(t,o){},encapsulation:2})}return i})(),b=class{ID="editor.widget.placeholderHint";placeholder;editor;node;constructor(n,e){this.placeholder=e,this.editor=n}update(n){this.node!=null&&(this.node.innerHTML=n??this.placeholder??"")}getId(){return this.ID}getDomNode(){if(this.node==null){let n=this.node=document.createElement("div");n.classList.add("monaco-editor-placeholder"),n.style.width="max-content",n.style.color="gray",n.innerHTML=this.placeholder,n.style.fontStyle="italic",this.editor.applyFontInfo(n)}return this.node}getPosition(){return{position:{lineNumber:1,column:1},preference:[monaco.editor.ContentWidgetPositionPreference.EXACT]}}dispose(){this.editor.removeContentWidget(this)}},Z=(()=>{class i extends W{_value="";_placeholderWidget;placeholder=d();model=d();autoFormat=d(!0,{transform:g});maxHeight=d(1e3,{transform:p});get editor(){return this._editor}constructor(){super(),u(()=>{let e=this.placeholder();this._placeholderWidget?.update(e)}),u(()=>{this.model()!=null&&this.updateOptions(O(()=>this.options()))})}togglePlaceholder(){let e=this.placeholder();e==null||e.length<=0||this.editor==null||(this._placeholderWidget==null&&(this._placeholderWidget=new b(this.editor,e)),this._value.length>0?this.editor.removeContentWidget(this._placeholderWidget):this.editor.addContentWidget(this._placeholderWidget))}onChange=e=>{};onTouched=()=>{};initMonaco(e,t){let o=!!this.model();e=h(h({},this.config?.defaultOptions),e);let r=this.height()==="auto";if(r&&(e.scrollBeyondLastLine=!1,e.overviewRulerLanes=0),o){let l=monaco.editor.getModel(this.model().uri||"");if(l)e.model=l,e.model.setValue(this._value);else{let{value:V,language:k,uri:U}=this.model();e.model=monaco.editor.createModel(V||this._value,k,U)}this._value=e.model.getValue()}this._disabled!=null&&(e.readOnly=this._disabled);let a=this._editor=monaco.editor.create(this.el.nativeElement,e);o||a.setValue(this._value),a.onDidChangeModelContent(()=>{let l=a.getValue();this._value=l,this.onChange(l),this.togglePlaceholder()}),a.onDidBlurEditorWidget(()=>this.onTouched()),this.togglePlaceholder(),this.registerResize(),r&&(a.onDidContentSizeChange(()=>this.updateHeight()),this.updateHeight());let s=t?"init":"re-init";if(this.autoFormat()){f(this._config.autoFormatTime).pipe(v(this.destroy$),M(1)).subscribe(()=>{this.format()?.then(()=>this.notifyEvent(s))});return}this.notifyEvent(s)}updateHeight(){let e=this.editor;if(e==null)return;let t=Math.min(this.maxHeight(),e.getContentHeight());e.layout({width:e.getLayoutInfo().width,height:t})}format(){let e=this.editor?.getAction("editor.action.formatDocument");if(e!=null)return e.run()}writeValue(e){this._value=e||"",this._editor?.setValue(this._value),this.autoFormat()&&this.format()}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.setDisabled(e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=m({type:i,selectors:[["nu-monaco-editor"]],hostVars:4,hostBindings:function(t,o){t&2&&A("display","block")("height",o.height())},inputs:{placeholder:[1,"placeholder"],model:[1,"model"],autoFormat:[1,"autoFormat"],maxHeight:[1,"maxHeight"]},exportAs:["nuMonacoEditor"],features:[H([{provide:I,useExisting:D(()=>i),multi:!0}]),T],decls:0,vars:0,template:function(t,o){},encapsulation:2,changeDetection:0})}return i})();export{Y as a,Z as b};
