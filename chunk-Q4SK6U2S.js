import{a as P}from"./chunk-EEXBANEL.js";import{Bc as T,Dd as I,E as u,F as f,O as m,P as p,Za as h,a as l,ba as g,bb as C,dc as O,ea as v,ga as a,ha as y,jb as w,qa as _,sa as M,ua as E,uc as N,va as D,vc as F,za as b}from"./chunk-SCDKUK6D.js";var R=new v("NU_MONACO_EDITOR_CONFIG");function ee(o){return y([{provide:R,useValue:o}])}var x=!1,A,k=(()=>{class o{set disabled(e){this._disabled=typeof e=="string"?!0:e,this.setDisabled()}set options(e){this._options=l(l({},this._config.defaultOptions),e),this.updateOptions()}get options(){return this._options}constructor(){this.el=a(b),this.config=a(R,{optional:!0}),this.doc=a(T),this.ngZone=a(D),this.destroy$=a(M),this._resize$=null,this.height="200px",this.delay=0,this.event=new E,this._config=l({baseUrl:"https://cdn.jsdelivr.net/npm/monaco-editor/min",autoFormatTime:100},this.config),this.options=this._config.defaultOptions}notifyEvent(e,n){this.ngZone.run(()=>this.event.emit(l({type:e,editor:this._editor},n)))}setDisabled(){return this._editor?.updateOptions({readOnly:this._disabled}),this}init(){if(x){A.then(()=>this.initMonaco(this.options,!0));return}x=!0,A=new Promise((e,n)=>{let t=window;if(t==null){e();return}if(t.monaco){e();return}let s=`${this._config.baseUrl}/vs`;/^https?:\/\//g.test(s)||(s=`${window.location.origin}/${s.startsWith("/")?s.substring(1):s}`);let d=()=>{t.require.config({paths:{vs:s}}),typeof this._config.monacoPreLoad=="function"&&this._config.monacoPreLoad(),t.require(["vs/editor/editor.main"],()=>{typeof this._config.monacoLoad=="function"&&this._config.monacoLoad(t.monaco),this.initMonaco(this.options,!0),e()},()=>{n("Unable to load editor/editor.main module, please check your network environment.")})};if(t.require)d();else{let i=this.doc.createElement("script");i.type="text/javascript",i.src=`${s}/loader.js`,i.onload=d,i.onerror=()=>n(`Unable to load ${i.src}, please check your network environment.`),this.doc.getElementsByTagName("head")[0].appendChild(i)}}).catch(e=>this.notifyEvent("load-error",{error:e}))}cleanResize(){return this._resize$?.unsubscribe(),this}registerResize(){return this.cleanResize(),this._resize$=u(window,"resize").pipe(m(100)).subscribe(()=>{this._editor.layout(),this.notifyEvent("resize")}),this}updateOptions(){this._editor&&this.ngZone.runOutsideAngular(()=>{this._editor.dispose(),this.initMonaco(this._options,!1)})}ngAfterViewInit(){this.ngZone.runOutsideAngular(()=>setTimeout(()=>this.init(),+this.delay))}ngOnDestroy(){this.cleanResize(),this._editor?.dispose()}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=h({type:o,selectors:[["nu-monaco-base"]],inputs:{height:"height",delay:[2,"delay","delay",F],disabled:"disabled",options:"options"},outputs:{event:"event"},decls:0,vars:0,template:function(n,t){},encapsulation:2})}}return o})(),c=class{constructor(r,e){this.ID="editor.widget.placeholderHint",this.placeholder=e,this.editor=r}update(r){this.node!=null&&(this.node.innerHTML=r??this.placeholder??"")}getId(){return this.ID}getDomNode(){if(this.node==null){let r=this.node=document.createElement("div");r.classList.add("monaco-editor-placeholder"),r.style.width="max-content",r.style.color="gray",r.innerHTML=this.placeholder,r.style.fontStyle="italic",this.editor.applyFontInfo(r)}return this.node}getPosition(){return{position:{lineNumber:1,column:1},preference:[monaco.editor.ContentWidgetPositionPreference.EXACT]}}dispose(){this.editor.removeContentWidget(this)}},te=(()=>{class o extends k{constructor(){super(...arguments),this._value="",this.autoFormat=!0,this.onChange=e=>{},this.onTouched=()=>{}}set placeholder(e){this._placeholder=e,this._placeholderWidget?.update(e)}get editor(){return this._editor}togglePlaceholder(){let e=this._placeholder;e==null||e.length<=0||this.editor==null||(this._placeholderWidget==null&&(this._placeholderWidget=new c(this.editor,e)),this._value.length>0?this.editor.removeContentWidget(this._placeholderWidget):this.editor.addContentWidget(this._placeholderWidget))}initMonaco(e,n){let t=!!this.model;if(t){let i=monaco.editor.getModel(this.model.uri||"");if(i)e.model=i,e.model.setValue(this._value);else{let{value:V,language:z,uri:U}=this.model;e.model=monaco.editor.createModel(V||this._value,z,U)}}this._disabled!=null&&(e.readOnly=this._disabled);let s=this._editor=monaco.editor.create(this.el.nativeElement,e);t||s.setValue(this._value),s.onDidChangeModelContent(()=>{let i=s.getValue();this.ngZone.run(()=>{this._value=i,this.onChange(i)}),this.togglePlaceholder()}),s.onDidBlurEditorWidget(()=>this.onTouched()),this.togglePlaceholder(),this.registerResize();let d=n?"init":"re-init";if(this.autoFormat){f(this._config.autoFormatTime).pipe(I(this.destroy$),p(1)).subscribe(()=>{let i=s.getAction("editor.action.formatDocument");if(i==null){this.notifyEvent(d);return}i.run().then(()=>this.notifyEvent(d))});return}this.notifyEvent(d)}writeValue(e){this._value=e||"",this._editor?.setValue(this._value)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e,this.setDisabled()}static{this.\u0275fac=(()=>{let e;return function(t){return(e||(e=_(o)))(t||o)}})()}static{this.\u0275cmp=h({type:o,selectors:[["nu-monaco-editor"]],hostVars:4,hostBindings:function(n,t){n&2&&w("display","block")("height",t.height)},inputs:{placeholder:"placeholder",model:"model",autoFormat:[2,"autoFormat","autoFormat",N]},exportAs:["nuMonacoEditor"],features:[O([{provide:P,useExisting:g(()=>o),multi:!0}]),C],decls:0,vars:0,template:function(n,t){},encapsulation:2,changeDetection:0})}}return o})();export{ee as a,te as b};
