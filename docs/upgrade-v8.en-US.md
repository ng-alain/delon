---
order: 11
type: Basic
title: Upgrade to V8
hot: true
---

NG-ALAIN 8.0 changes of three parts:

| Library | Support Cli Upgrade | Description |
| --- | ---------- | ---- |
| Angular | Yes | - |
| NG-ZORRO | No | Maybe the official version will provide partial support |
| Delon | No | Only one ACL class library reference |

# Requirements

Remove unused class libraries:

- `tslint-language-service`
- `core-js` Support differential loading after Angular auto management polyfills

# Upgrade

## 1.Angular

Angular upgrades can be check each step according to [update.angular.io](https://update.angular.io/#7.0:8.0), and the following commands can almost seamlessly upgrade breaking changes:

```bash
ng update @angular/cli @angular/core
```

Some changes to the details:

1. Update the `package.json` dependency package version information, but not latest version number, you can use [#diff-10](https://github.com/ng-alain/ng-alain/pull/1165/files#diff-10) learn the details
2. **Adjust to support differential loading** Update `tsconfig.json` with `module` for [esnext](https://github.com/ng-alain/ng-alain/pull/1165/files#diff-e5e546dd2eb0351f813d63d1b39dbc48R8), and remove all related introductions of `core-js` under `polyfills.ts`
3. Auto handle breaking changes: `ViewChild` or `ContentChild`. For details please refer to [Static Query Migration Guide](https://angular.io/guide/static-query-migration)
4. Auto handle breaking changes: route lazy loading module. For details please refer to [loadChildren string syntax](https://angular.io/guide/deprecations#loadchildren-string-syntax)

## 2.NG-ZORRO

Contains two breaking changes: `nz-dropdown` and `form`, still keeping the old API to the `9.x` version, and there will be a warning in the development environment.

NG-ZORRO **don't** provide Cli tool upgrades. For more details, please refer to [8.x Documentation](https://ng-zorro-master.netlify.com/docs/introduce/zh). The following are examples before and after the change:

### nz-dropdown

```html
<nz-dropdown nzPlacement="bottomRight">
  <div nz-dropdown>Button</div>
  <ul nz-menu>
    <li nz-menu-item>Item 1</li>
    <li nz-menu-item>Item 2</li>
  </ul>
</nz-dropdown>
```

After:

```html
<div nz-dropdown nzPlacement="bottomRight" [nzDropdownMenu]="menuTpl">Button</div>
<nz-dropdown-menu #menuTpl="nzDropdownMenu">
  <ul nz-menu>
    <li nz-menu-item>Item 1</li>
    <li nz-menu-item>Item 2</li>
  </ul>
</nz-dropdown-menu>
```

### form

```html
<form nz-form [nzLayout]="'inline'" [formGroup]="validateForm" (ngSubmit)="submitForm()">
  <nz-form-item>
    <nz-form-control>
      <nz-input-group [nzPrefix]="prefixUser">
        <input formControlName="userName" nz-input placeholder="Username" />
      </nz-input-group>
      <nz-form-explain *ngIf="validateForm.get('userName')?.dirty && validateForm.get('userName')?.errors"
      >Please input your username!</nz-form-explain
      >
    </nz-form-control>
  </nz-form-item>
</form>
```

After:

```html
<form nz-form [nzLayout]="'inline'" [formGroup]="validateForm" (ngSubmit)="submitForm()">
  <nz-form-item>
    <nz-form-control nzErrorTip="Please input your username!">
      <nz-input-group nzPrefixIcon="user">
        <input formControlName="userName" nz-input placeholder="Username" />
      </nz-input-group>
    </nz-form-control>
  </nz-form-item>
</form>
```

## 3„ÄÅDelon

Muse manually modify the `@delon/*` and `ng-alain` dependencies in `package.json` to be the version number: `^8.0.0-rc.0`:

```bash
yarn
```

### ACL

`DelonACLModule` requires `forRoot()`, see [delon.module.ts](https://github.com/ng-alain/ng-alain/pull/1165/files#diff-19).

# Optional Upgrade

## tsconfig.json

NG-ALAIN is always based on the infrastructure generated by Angular Cli, so there are some minor changes to the file structure, but it does not affect the existing structure:

1. The original `src/tsconfig.app.json`, `src/tsconfig.spec.json`, `karma.conf.js` are moved to the root directory, and the corresponding path of `angular.json` needs to be modified synchronously.
2. `tsconfig.app.json` and `tsconfig.spec.json` do not need to set the `paths` attributes.
```diff
- "paths": {	
-   "@shared": [ "app/shared/index" ],	
-   "@shared/*": [ "app/shared/*" ],	
-   "@core": [ "app/core/index" ],	
-   "@core/*": [ "app/core/*" ],	
-   "@env/*": [ "environments/*" ]	
- }
```
3. Fix the corresponding path of the `lint:ts` command line
```diff
- "lint:ts": "tslint -p src/tsconfig.app.json -c tslint.json \"src/**/*.ts\" --fix",
+ "lint:ts": "tslint -p tsconfig.app.json -c tslint.json \"src/**/*.ts\" --fix",
```

## Command Line

Avoid executing `ng build` when throw error **JavaScript heap out of memory**:

```diff
- "build": "npm run color-less && ng build --prod --build-optimizer",
+ "build": "npm run color-less && node --max_old_space_size=5120 ./node_modules/@angular/cli/bin/ng build --prod",
- "analyze": "ng build --prod --build-optimizer --stats-json",
+ "analyze": "node --max_old_space_size=5120 ./node_modules/@angular/cli/bin/ng build --prod --stats-json",
```
